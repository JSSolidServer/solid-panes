# 20210404a
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix solid: <http://www.w3.org/ns/solid/terms#>.
@prefix ui: <http://www.w3.org/ns/ui#>.
@prefix schema: <http://schema.org/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.

@prefix org: <http://www.w3.org/ns/org#>.
@prefix esco: <http://data.europa.eu/esco/model#>.

@prefix : <#>.

:this
    <http://purl.org/dc/elements/1.1/title> "Profile form" ;
    a ui:Form ;
    # ui:part :backgroundColor, :highlightColor;
    ui:parts (
      :styleGroup
      :pronounsForm
      :CVGroup
      :SkillsPrompt :SkillsForm
      :LanguagesPrompt :LanguagesForm
      ).

:styleGroup a ui:Group; ui:parts ( :styleHeading :backgroundColor :highlightColor ).
    :styleHeading a ui:Heading; ui:contents "The style of your public profile.".
    :backgroundColor a ui:ColorField; ui:property solid:profileBackgroundColor;
      ui:label "Background color"; ui:default "#ffffff".
    :highlightColor a ui:ColorField; ui:property solid:profileHighlightColor;
      ui:label "Highlight color"; ui:default "#000000".

 # Pronouns

 :pronounsForm a ui:Group; ui:parts ( :pronounsPrompt :subjectPronounForm :objectPronounForm :relativePronounForm) .

    :pronounsPrompt a ui:Comment; ui:contents  "What are your pronouns?" .

    :subjectPronounForm a ui:SingleLineTextField; ui:property solid:preferredSubjectPronoun;
        ui:size 10; ui:label "he/she/they..." .
    :objectPronounForm a ui:SingleLineTextField; ui:property solid:preferredObjectPronoun;
        ui:size 10; ui:label "him/her/them..." .
    :relativePronounForm a ui:SingleLineTextField; ui:property solid:preferredRelativePronoun;
        ui:size 10; ui:label "his/hers/theirs..." .

  # Curriculum Vitae: membership of organizations

  :CVHeading a ui:Heading; ui:contents "Public Curriculum Vitae".
  :CVPrompt a ui:Comment; ui:contents  "What organizations have you been involved with?" .

    :CVGroup a ui:Group; ui:parts ( :CVHeading :CVPrompt :involvementWithOrganizationsForm ).


  solid:Role a rdfs:Class; owl:oneOf ( solid:CurrentRole solid:FormerRole ). # Future Role too?

  org:member owl:inverse [ ui:label "involvement with company, org etc" ]. # timelimited involvement

  :involvementWithOrganizationsForm a ui:Multiple;
      ui:label "Involvement with Organization";
      ui:property org:member; ui:reverse true; # link back from role to member
      ui:ordered false; # Allow user to order CV secions rather than force date order? No.
      ui:part :membershipForm.

  :membershipForm a ui:Group; ui:parts ( :roleNameField :escoOccupationField :instituteIdentityField :orgField :startField :endField ).

      :startField a ui:DateField; ui:property schema:startDate; ui:label "Starting"@en, "DÃ©but"@fr.
      :endField   a ui:DateField; ui:property schema:endDate;   ui:label "Ending"@en, "Fin"@fr.
      :orgField a ui:Choice; ui:label "Organization"@en, "Organization"@fr;
          ui:canMintNew true; ui:use :OrganizationCreationForm ;
          ui:property org:organization;
          ui:from vcard:Organization .
     :roleNameField a ui:SingleLineTextField; ui:property vcard:role; ui:size 60 .

    :escoOccupationField a ui:AutocompleteField;
          ui:label "occupation"; ui:size 60;
          ui:property org:Role;
          ui:dataSource :ESCO_Occupation_DataSource;
           ui:targetClass schema:Occupation .

         :ESCO_Occupation_DataSource a ui:DataSource;
            schema:name "ESCO";
            ui:targetClass schema:Occupation ;
            schema:logo <https://ec.europa.eu/esco/portal/static_resource2/images/logo/logo_en.gif>;
            ui:searchByNameURI "https://ec.europa.eu/esco/api/search?language=$(language)&type=occupation&text=$(name)".

     :instituteIdentityField a ui:AutocompleteField; ui:label "in wikidata";
          ui:size 60;
          ui:property solid:publicId; ui:dataSource :WikidataOnOrganizations.

     :WikidataOnOrganizations a ui:DataSource ;
       schema:name "Wikidata";
       ui:endpoint "https://query.wikidata.org/sparql" ;
       ui:targetClass  <http://www.wikidata.org/entity/Q43229>; # Use if nothing else
       ui:searchByNameQuery """SELECT ?subject ?name
       WHERE {
         ?klass wdt:P279* $(targetClass) .
         ?subject wdt:P31 ?klass .
         ?subject rdfs:label ?name.
         FILTER regex(?name, "$(name)", "i")
       } LIMIT $(limit) """ .

      :WikidataOnOrganizations ui:classMap
       [ ui:internalClass schema:Corporation; ui:externalClass <http://www.wikidata.org/entity/Q6881511>], #Enterprise is for-profit
       [ ui:internalClass schema:vEducationalOrganization; ui:externalClass <http://www.wikidata.org/entity/Q178706>], #insitution
       [ ui:internalClass schema:GovernmentOrganization; ui:externalClass <http://www.wikidata.org/entity/Q327333>], #government agency
       [ ui:internalClass schema:MedicalOrganization; ui:externalClass <http://www.wikidata.org/entity/Q4287745>],
       [ ui:internalClass schema:MusicGroup; ui:externalClass <http://www.wikidata.org/entity/Q32178211>], #music organization
       [ ui:internalClass schema:NGO; ui:externalClass <http://www.wikidata.org/entity/Q163740>], #nonprofit organization @@
       [ ui:internalClass schema:Occupation; ui:externalClass <http://www.wikidata.org/entity/Q28640>], # superclass: Profession
       [ ui:internalClass schema:Organization; ui:externalClass <http://www.wikidata.org/entity/Q43229>], # Superclass; Organization
       [ ui:internalClass schema:Project; ui:externalClass <http://www.wikidata.org/entity/Q170584>],
       [ ui:internalClass schema:SportsOrganization; ui:externalClass <http://www.wikidata.org/entity/Q4438121>] .


# Organizations

 vcard:Organization ui:creationForm :OrganizationCreationForm  .

# Ontology data to drive the classifier

solid:InterestingOrganization owl:disjointUnionOf  (
# Airline - a Corporation
# Consortium - a Corporation or a NGO
 schema:Corporation
 schema:EducationalOrganization
# FundingScheme - eh?
 schema:GovernmentOrganization
# LibrarySystem
# LocalBusiness - Corporation
# MedicalOrganization - a Corporation or a NGO
 schema:NGO
 # NewsMediaOrganization - a Corporation or a NGO
schema:PerformingGroup # a band
schema:Project # like Solid
schema:SportsOrganization # a Team
 ) .

  :OrganizationCreationForm a ui:Form; schema:name "Form for editing a role" ;
    ui:parts ( :OrgClassifier :homePageURIField  ) .


 :OrgClassifier a ui:Classifier; ui:label "What sort of organization?"@en;
    ui:category solid:InterestingOrganization .

  :instituteNameField
      a ui:SingleLineTextField ;
      ui:label "Intitute Name";
      ui:maxLength "200" ;
      ui:property schema:name ;
      ui:size "80" .

   :homePageURIField a ui:NamedNodeURIField;
      ui:property  schema:url . # @@ ??

    :initituteTypeField a ui:Classifier;
    ui:label "What sort of organization";
    ui:category solid:InterestingOrganization .


  # Skills

  :SkillsPrompt a ui:Comment; ui:contents  "Skills?" .

  :SkillsForm a ui:Multiple;
      ui:label "Skills";
      ui:property schema:skills;
      ui:ordered false; # Allow user to order CV secions rather than force date order? No.
      ui:part :SkillForm.

  :SkillForm a ui:Group; ui:parts ( :skillNameField :escoSkillField ).

        :skillNameField a ui:SingleLineTextField; ui:property vcard:role; ui:size 30 .

        :escoSkillField a ui:AutocompleteField;
              ui:label "skill"; ui:size 30;
              ui:property solid:publicId;
              ui:dataSource :ESCO_Skill_DataSource;
               ui:targetClass schema:Skill .

        :ESCO_Skill_DataSource a ui:DataSource;
           schema:name "ESCO Skill";
           ui:targetClass esco:Skill ;
           schema:logo <https://ec.europa.eu/esco/portal/static_resource2/images/logo/logo_en.gif>;
           ui:searchByNameURI "https://ec.europa.eu/esco/api/search?language=$(language)&type=skill&text=$(name)".

# Language

:LanguagesPrompt a ui:Comment; ui:contents  "Languages?" .

:LanguagesForm a ui:Multiple;
    ui:label "Languages";
    ui:property schema:knowsLanguage; # @@@
    ui:ordered true; # Allow user to order languages most important first.
    ui:part :LanguageForm.

:LanguageForm a ui:Group; ui:parts ( :WikidataLanguageField ).

    :WikidataLanguageField a ui:AutocompleteField;
          ui:label "Language"; ui:size 30;
          ui:property solid:publicId; # @@
          ui:dataSource :WikidataLanguageDataSource;
           ui:targetClass schema:Language .

    :WikidataLanguageDataSource
        schema:name "Wikidata languages";
        ui:endpoint "https://query.wikidata.org/sparql" ;
        ui:objectURIBase <https://www.w3.org/ns/iana/language-code/>;
        # Add this to any literal string returned as ?subject

         ui:searchByNameQuery """SELECT ?item ?subject ?name
WHERE
{ ?item wdt:P305 ?subject .
  OPTIONAL {?item rdfs:label ?name}
  OPTIONAL {?item wdt:P1705 ?name}
  FILTER regex(?name, "$(name)", "i")
  FILTER regex(?subject, "^..$", "i")
}""" .
 # Note we restrict code to two-letter codes with the second regex, so as to limit the deluge of languages
 # Hope there are not any important ones which have three-letter codes.
 # Omitted: SERVICE wikibase:label { bd:serviceParam wikibase:language "$(languages)". }


# ENDS
